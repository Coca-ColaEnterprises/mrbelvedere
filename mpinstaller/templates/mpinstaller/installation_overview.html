{% extends 'mpinstaller/base.html' %}

{% load bootstrap3 %}

{% block bootstrap3_title %}{{ version.package }} Installation Status{% endblock %}
{% block bootstrap3_page_title %}<a href="{{ version.get_installer_url }}">{{ version.package }} Installation Status</a>{% endblock %}
{% block bootstrap3_page_description %}This page shows the status of installing the {{ version.package }} into your connected Salesforce org.{% endblock %}

{% block extra_head %}
<script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.2.15/angular.js"></script> 
<script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.2.15/angular-sanitize.js"></script> 
<script type="text/javascript">
  var status_api_url = '{{ status_api_url }}';
</script>
<script src="/static/js/installation_status.js"></script> 

<style type="text/css">
  #installation-progress-bar .progress {
    height: 40px;
  }
  #installation-progress-bar .progress-bar {
    font-size: 21px;
    font-weight; bold;
    padding-top: 10px;
  }
</style>
{% endblock %}

{% block bootstrap3_content %}

{% bootstrap_messages %}

{% verbatim %}

  <div class="installation-status" ng-app="InstallationStatusApp" ng-controller="InstallationStatusController">

    <div class="panel panel-default">
      <div class="panel-heading">
        <h3 class="panel-title">
          <span class="glyphicon" ng-class="{'glyphicon-ok': (installation.status == 'Succeeded'),'glyphicon-warning-sign': (installation.status == 'Failed'),}"></span>
          Overall Status
        </h3>
      </div>
      
      <div class="panel-body">  
        <div id="installation-progress-bar">
          <div class="progress" ng-class="{'progress-bar-striped active': (installation.progress < 100)}">
            <div class="progress-bar" ng-class="{'progress-bar-success': (installation.status == 'Succeeded'), 'progress-bar-danger': (installation.status == 'Failed'),'progress-bar-primary': (installation.status == 'InProgress'), 'progress-bar-default': (installation.status == 'Pending')}" role="progressbar" aria-valuenow="{{installation.progress}}" aria-valuemin="0" aria-valuemax="100" style="width: {{installation.progress}}%">
              {{installation.status}}
            </div>
          </div>
        </div>
    
        <div class="alert alert-primary" ng-hide="installation.progress == 100">
          <span ng-hide="installation.status != 'Pending'">Your installation is waiting in the queue and will be started shortly.  This page will automatically update with the status of the installation once it starts.  You can close this page if desired and the installation will still run in the background</span>
          <span ng-hide="installation.status != 'InProgress'">Your installation is now running in the background.  This page will automatically update with the status until the installation completes.  You can close this page if desired and the installation will still run in the background</span>
        </div>

        <div class="bs-callout bs-callout-success content-next-steps content-next-steps-succeeded" ng-if="installation.status == 'Succeeded' && installation.content_success">
          <h4>Next Steps</h4>
          <ul class="list-group">
            <li class="list-group-item contextual-content" ng-repeat="content in installation.content_success">
              <div class="row">
                <div class="col-md-2">
                  <h5>{{content.heading}}</h5>
                </div>
                <div class="col-md-10">
                  <span ng-bind-html="content.body" />
                </div>
              </div>
            </li>
          </ul>
        </div>
          
        <div class="bs-callout bs-callout-warning content-next-steps content-next-steps-failed" ng-if="installation.status == 'Failed' && installation.content_failure">
          <h4>Next Steps</h4>
          <div class="contextual-content" ng-repeat="content in installation.content_failure">
            <h4>{{content.heading}} Next Steps</h4>
            <p ng-bind-html="content.body"></p>
          </div>
        </div>

        <a href="/mpinstaller/npsp/beta"><span class="glyphicon glyphicon-arrow-left"></span> Return to package overview to retry the installation</a>
   
     
        <h3>Installation Log</h3>
        
        <ul class="list-group" id="installation-steps">
          
          <li class="list-group-item" ng-class="{'list-group-item-success': (step.status == 'Succeeded' && step.action != 'skip'), 'text-muted': (step.action == 'skip'), 'list-group-item-danger': (step.status == 'Failed'),'list-group-item-primary': (step.status == 'InProgress'), 'list-group-item-default': (step.status == 'Pending')}" ng-repeat="step in installation.steps">
            <div class="row">
              <div class="col-md-3">
                
                
                <div ng-class="{'text-success': (step.status == 'Succeeded' && step.action != 'skip'), 'text-muted': (step.action == 'skip'), 'text-warning': (step.status == 'Cancelled'), 'text-danger': (step.status == 'Failed'),'text-primary': (step.status == 'InProgress'), 'text-default': (step.status == 'Pending')}">
                  <span ng-hide="step.action != 'install' || step.status == 'Cancelled'"><span class="glyphicon glyphicon-cloud-upload"></span> Install</span>
                  <span ng-hide="step.action != 'upgrade' || step.status == 'Cancelled'"><span class="glyphicon glyphicon-cloud-upload"></span> Upgrade</span>
                  <span ng-hide="step.action != 'uninstall' || step.status == 'Cancelled'"><span class="glyphicon glyphicon-cloud-upload"></span> Uninstall</span>
                  <span ng-hide="step.action != 'skip' || step.status == 'Cancelled'"><span class="glyphicon glyphicon-ok"></span> No Change</span>
                  <span ng-hide="step.status != 'Cancelled'"><span class="glyphicon glyphicon-ban-circle"></span> Cancelled</span>
                </div>
                
                <div class="progress" ng-hide="step.status == 'Cancelled' || step.action == 'skip'" ng-class="{'progress-bar-striped active': (step.progress < 100)}">
                  <div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="{{step.progress}}" aria-valuemin="0" aria-valuemax="100" style="width: {{step.progress}}%">
                    {{step.status}}
                  </div>
                </div>
                
              </div>
  
              <div class="col-md-6">
                <h3 class="panel-title">
                  {{step.version.package.name}}
                </h3>
                <p>{{step.version.package.description}}</p>
              </div>

              <div class="col-md-2">
                <span ng-hide="step.version.zip_url == null || step.version.zip_url == ''" class="badge"><span class="glyphicon glyphicon-compressed"></span> Metadata Bundle</span>
                <span ng-hide="step.version.number == null || step.version.number == ''" class="badge alert-info"><span class="glyphicon glyphicon-gift"></span> Managed Package</span>
                <span ng-hide="step.version.is_beta != true" class="badge alert-warning"><span class="glyphicon glyphicon-warning-sign"></span> Beta Releae</span>
              </div>
            </div>
    
            <div class="well" ng-hide="step.log == '' || step.log == null">
              {{step.log}}
            </div>

          </li>
          
        </ul>
        </div>
      </div>
    
    </div>
  </div>
{% endverbatim %}
{% endblock %}
